<!DOCTYPE html>
<html lang="en">
	<head>
		<title>DSCarousel Testing Grounds</title>
		<meta charset="utf-8">
	</head>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>

	<script src="DSCarousel.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			console.log('loaded');
			var DOMCarousel = document.querySelector('.carousel');
			var dscarousel = new DSCarousel(DOMCarousel, {axis: 'horizontal', GSAP: true, GSAPEase: Elastic.easeOut.config(1, 0.5)});

			//TweenMax.to(document.querySelector('.carousel'), 10, {rotationY: '-360deg', ease: Power0.easeNone, repeat: -1});
			/*
			setInterval(function() {
				carousel.next();
			}, 1000);
			*/

					[].slice.call(document.querySelectorAll('ul.controls li'), 0).forEach(function(element) {
						console.log(element);
						element.addEventListener('click', function(e) {
							var newElement;
							var results;
							var timeline;
							e.preventDefault();

							if (this.classList.contains('prev')) {
								console.log('previous');
								dscarousel.previous();
							} else if (this.classList.contains('next')) {
								console.log('next');
								dscarousel.next();
							} else if (this.classList.contains('add')) {
								newElement = document.createElement('div');
								newElement.innerHTML = Date.now();
								DOMCarousel.append(newElement);


								results = dscarousel.build(true);

								if (typeof results !== 'undefined') {
									timeline = new TimelineMax();

									results.slides.forEach(function(slide) {
										var animationProps = {};
										animationProps['rotation' + slide.axis] = slide.angle + 'deg';
										animationProps.z = slide.magnitude + 'px';

										timeline.to(slide.DOMElement, 1, {transform: slide.transformCSS}, '0');
									});
									var animationProps = {};
									console.log(results);

									animationProps['rotation' + results.dscarousel.axis] = results.dscarousel.angle + 'deg';
									timeline.to(DOMCarousel, 1, {rotateY: results.dscarousel.angle}, '0');

									timeline.add(function() {
										dscarousel.build();
									});
								}


								//dscarousel.build();
							} else if (this.classList.contains('remove')) {
								DOMCarousel.removeChild(DOMCarousel.querySelector(':last-child'));
								results = dscarousel.build(true);

								if (typeof results !== 'undefined') {
									timeline = new TimelineMax();
									results.slides.forEach(function(slide) {
										var animationProps = {};
										animationProps['rotation' + slide.axis] = slide.angle + 'deg';
										animationProps.z = slide.magnitude + 'px';

										timeline.to(slide.DOMElement, 1, {transform: slide.transformCSS}, '0');
									});
									var animationProps = {};
									animationProps['rotation' + results.dscarousel.axis] = results.dscarousel.angle + 'deg';
									console.log(results);
									timeline.to(results.dscarousel.DOMElement, 1, {rotationY: results.dscarousel.angle}, '0');
									timeline.add(function() {
										dscarousel.build();
									});
								}
							}
						});
					});
		});
	</script>
	<style>
		body, html {
			margin: 0;
			padding: 0;
			background-color: #8b8e89;
			min-width: 100vw;
			min-height: 100vh;
			overflow: hidden;
		}

		body {
			display: table;
		}

		body > .container {
			display: table-cell;
			vertical-align: middle;
			text-align: center;
			transform-style: preserve-3d;
			transform: rotateX(20deg);
		}

		div.carousel {
			position: relative;
			width: 500px;
			height: 500px;
			white-space: nowrap;
			margin: 0px auto;
			transform-style: preserve-3d;
		}


		div.carousel > div {
			width: 100%;
			height: 100%;
			background-color: #fff;
			color: #000;
			position: absolute;
			top: 0;
			left: 0;
			/*
			backface-visibility: hidden;
			webkit-backface-visibility: hidden;
			*/
		}

		div.carousel > div:first-child {
			position: relative;
		}

		div.carousel > div:nth-child(2n) {
			background-color: #000;
			color: #fff;
		}

		ul.controls {
			padding: 0;
			display: flex;
			justify-content: center;
			z-index:100;
			transform: translateZ(1000px);
		}

		ul.controls li {
			list-style: none;
			padding: 0;
		}

		ul.controls li button {
			width: 100%;
		}
	</style>
<body>
	<div class="container">
		<div class="carousel">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
			<div>E</div>
		</div>
		<ul class="controls">
			<li class="next"><button>NEXT</button></li>
			<li class="prev"><button>PREV</button></li>
			<li class="add"><button>ADD</button></li>
			<li class="remove"><button>REMOVE</button></li>
		</ul>
	</div>
</body>
</html>